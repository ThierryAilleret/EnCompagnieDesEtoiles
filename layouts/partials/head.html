<!-- üåê Chargement imm√©diat de gtag.js -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZQ2FL4130K"></script>

<!-- üéØ Initialisation gtag + consentement par d√©faut -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }

  // Consentement par d√©faut : tout refus√©
  gtag('consent', 'default', {
    ad_storage: 'denied',
    analytics_storage: 'denied'
  });

  gtag('js', new Date());
  gtag('config', 'G-ZQ2FL4130K');
</script>

<!-- üç™ Tarteaucitron : style + scripts -->
<link rel="stylesheet" href="/js/tarteaucitron/css/tarteaucitron.custom.css">
<script src="/js/tarteaucitron/tarteaucitron.js"></script>
<script src="/js/tarteaucitron/tarteaucitron.services.js"></script>

<script>
  // D√©claration du service GA4 pour Tarteaucitron
  tarteaucitron.user.gtagUa = 'G-ZQ2FL4130K';
  tarteaucitron.job = tarteaucitron.job || [];
  tarteaucitron.job.push('gtag');

  tarteaucitron.init({
    privacyUrl: "/politique-confidentialite/",
    hashtag: "#tarteaucitron",
    cookieName: "tarteaucitron",
    orientation: "bottom",
    showAlertSmall: false,
    cookieslist: true,
    showIcon: false,
    iconPosition: "BottomRight",
    DenyAllCta: true,
    AcceptAllCta: true,
    highPrivacy: true,
    handleBrowserDNTRequest: false,
    removeCredit: true,
    moreInfoLink: true,
    useExternalCss: true,
    useExternalJs: false
  });

  // üîÅ Synchronisation consentement GA ‚Üî Tarteaucitron
  document.addEventListener('tac.root_available', function () {
    const cookie = tarteaucitron.cookie.read();

    if (cookie.includes('!gtag=true')) {
      gtag('consent', 'update', {
        ad_storage: 'granted',
        analytics_storage: 'granted'
      });
    } else if (cookie.includes('!gtag=false')) {
      gtag('consent', 'update', {
        ad_storage: 'denied',
        analytics_storage: 'denied'
      });
    }
  });
</script>
<script>
	//Compteur du nombre de pages vues
  (function () {
    // Ne pas compter dans l'√©diteur local de Hugo si tu veux
    if (window.location.hostname === 'localhost') {
      return;
    }

    const path = window.location.pathname;
    const today = new Date().toISOString().slice(0, 10); // "YYYY-MM-DD"

    fetch('/.netlify/functions/page-counter', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        path: path,
        date: today
      })
    }).catch(function (err) {
      // On ignore les erreurs, on ne casse pas le rendu
      console.warn('Page counter error', err);
    });
  })();
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ .Title }}</title>
<meta name="description" content="{{ .Params.description }}">
<!-- Favicon -->
<link rel="icon" href="{{ "images/favicon.ico" | relURL }}" type="image/x-icon">
<!-- Feuille de styles principale -->
<link rel="stylesheet" href="{{ "css/style.css" | relURL }}">
<!-- Autres m√©tadonn√©es -->
{{ if .IsHome }}
  <meta name="robots" content="index, follow">
{{ else }}
  <meta name="robots" content="noindex, follow">
{{ end }}
